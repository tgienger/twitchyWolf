(function(){function _$rapyd$_print(){var args,output;args=[].slice.call(arguments,0);output=JSON.stringify(args);if("console"in window)console.log(output.substr(1,output.length-2))}function len(obj){if(obj instanceof Array||typeof obj==="string")return obj.length;else{var count=0;for(var i in obj){if(obj.hasOwnProperty(i))count++}return count}}var myApp;"use strict";myApp=angular.module("twitchyApp",["ui.router","ui.bootstrap","angularjs.media.directives"]).config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/");$stateProvider.state("main",{url:"/",templateUrl:"app/partials/main.html",controller:"MainCtrl"}).state("stream",{url:"/stream",templateUrl:"app/partials/directives/stream.html",controller:"StreamCtrl"}).state("mychat",{url:"/mychat",templateUrl:"app/partials/directives/chat.html",controller:"ChatCtrl"})}).controller("StreamCtrl",function($scope,$http,$rootScope){$scope.l=""}).controller("MainCtrl",function($scope,$http,$rootScope,$window,$timeout){var url,clientId,defaultAccount;url="https://api.twitch.tv/kraken/";clientId="jmauht7mi0ud0hptf0l8060uqe41ybw";$scope.channel={};$scope.channelStarted=false;$scope.chatStarted=false;$scope.loadingStreams=false;$scope.searchCollapsed=true;$scope.userChannel=[];$scope.stream={};$scope.stream.width=620;$scope.stream.height=378;$scope.views={account:true,streams:false};$scope.adjust=function(){var height,width;height=$(window).height()-30;$("#menu").css({"height":height});width=$(window).width()-225;$("#streams").css({"width":width,"height":height})};$scope.adjust();window.onresize=function(){$scope.adjust()};$scope.viewStream=function(){$scope.views.streams=true;$scope.views.account=false;$timeout($scope.adjust,1)};$scope.viewAccount=function(){$scope.views.streams=false;$scope.views.account=true};defaultAccount={name:"Twitch Account"};$scope.user=defaultAccount;Twitch.init({clientId:clientId},function(error,status){if(error){_$rapyd$_print(error)}if(status.authenticated){$(".twitch-connect").hide();$(".twitch-logout").show();$rootScope.token=status.token}else{$(".twitch-logout").hide()}});Twitch.api({method:"user"},function(error,user){$scope.$apply(function(){$scope.user=user})});function bringFront(elem,stack){var group,min;group=$(stack);if(len(group)<1){return}min=parseInt(group[0].style.zIndex,10)||0;$(group).each(function(i){this.style.zIndex=min+1});if(elem===undefined){return}$(elem).css({"zIndex":min+len(group)})}$scope.openMyChat=function(){var myChat;if($scope.user.display_name===undefined){alert("You must log in")}else{window.user=$scope.user;myChat=$window.open("#/mychat",$scope.user.name,"height=500, width=350")}};$scope.miniMize=function(){if($scope.streams){$scope.streams={};$scope.stream.search=""}};$(".draggable").draggable({handle:".handle",stack:".windows",snap:true,containment:"document",iframeFix:true,opacity:.7,snapTolerance:10,snapMode:"outer"}).click(function(){bringFront($(this),".windows")}).css("position","absolute");$(".resizable").resizable();$scope.currentStream={};function startStream(){var height,width,streamPopup;_$rapyd$_print($(window).size);window.channelName=$scope.currentStream.channel.display_name;height=$(window).lastHeight||"378";width=$(window).lastWidth||"620";streamPopup=$window.open("#/stream","","height="+height+", width="+width+"")}$scope.playVideo=function(stream){$scope.currentStream=stream;startStream(stream)};$scope.queryStreams=function(stream){if(stream.search===""){$scope.streams={}}else{$scope.loadingStreams=true;$http.jsonp(url+"search/streams?callback=JSON_CALLBACK",{params:{q:stream.search,type:"suggest"}}).success(function(res){var stream;var _$rapyd$_Iter0=res.streams;for(var _$rapyd$_Index0=0;_$rapyd$_Index0<_$rapyd$_Iter0.length;_$rapyd$_Index0++){stream=_$rapyd$_Iter0[_$rapyd$_Index0];stream.preview.template=stream.preview.template.replace("{width}",200);stream.preview.template=stream.preview.template.replace("{height}",125)}$scope.streams=res.streams;$scope.loadingStreams=false})}};$scope.queryChannel=function(channel){$http.jsonp(url+"streams/"+channel.name.toLowerCase()+"?callback=JSON_CALLBACK&client_id="+$scope.clientId).success(function(res){$scope.channelInfo=res})};$scope.login=function(){Twitch.login({scope:["user_read","channel_read","chat_login","channel_check_subscription","user_subscriptions","channel_stream","channel_commercial","channel_editor","user_follows_edit","user_blocks_edit"],redirect_uri:"http://localhost:8080/#/"})};$scope.logout=function(){$scope.chatStarted=false;Twitch.logout(function(error){if(error){_$rapyd$_print(error)}$scope.user=defaultAccount;$(".twitch-connect").show();$(".twitch-logout").hide()})};$scope.closeTwitchy=function(){alert("this will close the overwolf window")}}).controller("StreamCtrl",function($scope,$http,$rootScope,$window){$scope.channelName=window.opener.channelName;window.opener.onbeforeunload=function(){window.close()};window.onresize=function(){window.parent.size={};window.parent.size.lastHeight=$(window).height();window.parent.size.lastWidth=$(window).width()};$scope.stream={width:"100%",height:"100%"};$scope.openChat=function(){var user,streamChat;if(!streamChat){user={};user.display_name=$scope.channelName;window.user=user;streamChat=window.open("#/mychat","streamChat","height=500, width=350")}};$scope.windowClose=function(){window.close()}}).controller("ChatCtrl",function($scope,$http){$scope.user=window.opener.user;window.opener.onbeforeunload=function(){window.close()}})})();